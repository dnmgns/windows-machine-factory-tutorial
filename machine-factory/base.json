{
  "variables": {
    "build_version": "1.0.0",
    "base_ami":"ami-3a3b1d52",
    "user":"vagrant",
    "password":"FooBar@123",
    "instance_type":"t2.small",
    "vpc_id":"",
    "subnet_id":""
  },  
  "builders": [
    {
      "type": "amazon-windows-ebs",
      "name": "base-ami",
      "region": "ap-southeast-2",
      "source_ami": "{{user `base_ami`}}",
      "instance_type": "{{user `instance_type`}}",
      "ami_name": "base-{{user `build_version`}}",
      "user_data_file":"./scripts/ec2-bootstrap.ps1",
      "associate_public_ip_address":false,
      "winrm_username": "{{user `user`}}",
      "winrm_password": "{{user `password`}}",
      "winrm_wait_timeout": "20m",
      "winrm_private_ip": true,
      "winrm_port":5985,
      "vpc_id": "{{user `vpc_id`}}",
      "subnet_id": "{{user `subnet_id`}}"
    }
  ],
  "provisioners": [
    {
      "type": "powershell",
      "elevated_user": "{{user `user`}}",
      "elevated_password": "{{user `password`}}",
      "scripts": [ "./scripts/provision.ps1" ]
    },
    {
      "type":"powershell",
      "scripts": [
        "./scripts/Ec2Config.ps1"
      ]
    }
  ]
}
